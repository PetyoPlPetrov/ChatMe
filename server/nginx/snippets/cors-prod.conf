# Production CORS Configuration
# Stricter CORS policy for production environments

# Set CORS origin based on allowed production domains
set $cors_origin "";

# Only allow configured production domains
# Update these patterns for your actual production domains
if ($http_origin ~* "^https://([a-zA-Z0-9-]+\.)?chatme\.example\.com$") {
    set $cors_origin $http_origin;
}

# For staging environments
if ($http_origin ~* "^https://([a-zA-Z0-9-]+\.)?staging\.chatme\.example\.com$") {
    set $cors_origin $http_origin;
}

# Default to configured origin if no match (for initial setup)
if ($cors_origin = "") {
    set $cors_origin "https://chatme.example.com";
}

# Apply CORS headers for production
add_header Access-Control-Allow-Origin $cors_origin always;
add_header Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS" always;
add_header Access-Control-Allow-Headers "Authorization, Content-Type, Accept, Origin, X-Requested-With" always;
add_header Access-Control-Allow-Credentials "true" always;